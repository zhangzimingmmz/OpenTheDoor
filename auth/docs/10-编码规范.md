# ç¼–ç è§„èŒƒ

> åŸºäºã€Šé˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œã€‹ï¼Œç»“åˆé¡¹ç›®å®é™…æƒ…å†µåˆ¶å®š

## ğŸ“‹ ç›®å½•

- [å‘½åè§„èŒƒ](#å‘½åè§„èŒƒ)
- [ä»£ç æ ¼å¼](#ä»£ç æ ¼å¼)
- [æ³¨é‡Šè§„èŒƒ](#æ³¨é‡Šè§„èŒƒ)
- [ç¼–ç¨‹è§„çº¦](#ç¼–ç¨‹è§„çº¦)
- [å¼‚å¸¸å¤„ç†](#å¼‚å¸¸å¤„ç†)
- [æ—¥å¿—è§„èŒƒ](#æ—¥å¿—è§„èŒƒ)
- [æ•°æ®åº“è§„èŒƒ](#æ•°æ®åº“è§„èŒƒ)
- [å®‰å…¨è§„èŒƒ](#å®‰å…¨è§„èŒƒ)
- [å•å…ƒæµ‹è¯•](#å•å…ƒæµ‹è¯•)
- [å·¥å…·é…ç½®](#å·¥å…·é…ç½®)

## ğŸ“ å‘½åè§„èŒƒ

### åŸºæœ¬åŸåˆ™

1. **è§åçŸ¥ä¹‰**ï¼šå‘½åè¦èƒ½å‡†ç¡®è¡¨è¾¾å…¶å«ä¹‰
2. **ç®€æ´æ˜äº†**ï¼šåœ¨è¡¨è¾¾æ¸…æ¥šçš„å‰æä¸‹å°½é‡ç®€çŸ­
3. **ç»Ÿä¸€é£æ ¼**ï¼šé¡¹ç›®å†…ä¿æŒä¸€è‡´çš„å‘½åé£æ ¼

### åŒ…åè§„èŒƒ

```
cn.zhangziming.auth.{æ¨¡å—å}.{å±‚çº§}

ç¤ºä¾‹ï¼š
cn.zhangziming.auth.common.exception
cn.zhangziming.auth.security.jwt
cn.zhangziming.auth.server.controller
```

**è§„åˆ™**ï¼š
- âœ… å…¨éƒ¨å°å†™
- âœ… å•è¯é—´ç”¨ç‚¹å·åˆ†éš”
- âœ… ä¸ä½¿ç”¨ä¸‹åˆ’çº¿æˆ–å¤§å†™å­—æ¯
- âŒ `cn.zhangziming.Boot.Common` ï¼ˆé”™è¯¯ï¼šä½¿ç”¨äº†å¤§å†™ï¼‰
- âŒ `cn.zhangziming.auth_common` ï¼ˆé”™è¯¯ï¼šä½¿ç”¨äº†ä¸‹åˆ’çº¿ï¼‰

### ç±»åè§„èŒƒ

#### æ™®é€šç±»

```java
// âœ… æ­£ç¡®ç¤ºä¾‹
public class UserController { }
public class OrderService { }
public class ProductMapper { }

// âŒ é”™è¯¯ç¤ºä¾‹
public class usercontroller { }  // åº”ä½¿ç”¨å¤§é©¼å³°
public class User_Service { }    // ä¸è¦ä½¿ç”¨ä¸‹åˆ’çº¿
```

#### ç‰¹æ®Šç±»å‘½å

| ç±»å‹ | è§„èŒƒ | ç¤ºä¾‹ |
|------|------|------|
| Controller | `XxxController` | `UserController` |
| Serviceæ¥å£ | `IXxxService` æˆ– `XxxService` | `IUserService` |
| Serviceå®ç° | `XxxServiceImpl` | `UserServiceImpl` |
| Mapper/DAO | `XxxMapper` | `UserMapper` |
| Entity/DO | `Xxx` | `User`, `Role` |
| DTO | `XxxDTO` | `UserDTO`, `LoginDTO` |
| VO | `XxxVO` | `UserVO` |
| Request | `XxxRequest` | `LoginRequest` |
| Response | `XxxResponse` | `TokenResponse` |
| Exception | `XxxException` | `BusinessException` |
| Utils | `XxxUtil` æˆ– `XxxUtils` | `StringUtil` |
| Config | `XxxConfig` | `RedisConfig` |
| Constant | `XxxConstant` | `CacheConstant` |

### æ–¹æ³•åè§„èŒƒ

```java
// âœ… æ­£ç¡®ç¤ºä¾‹
public void saveUser() { }           // ä¿å­˜
public void deleteUser() { }         // åˆ é™¤
public void updateUser() { }         // æ›´æ–°
public User getUserById(Long id) { } // æŸ¥è¯¢å•ä¸ª
public List<User> listUsers() { }    // æŸ¥è¯¢åˆ—è¡¨
public boolean isAdmin() { }         // åˆ¤æ–­
public boolean hasPermission() { }   // åˆ¤æ–­æ˜¯å¦æ‹¥æœ‰
public void validateToken() { }      // éªŒè¯
public String convertToJson() { }    // è½¬æ¢

// âŒ é”™è¯¯ç¤ºä¾‹
public void SaveUser() { }           // é¦–å­—æ¯ä¸åº”å¤§å†™
public void get_user() { }           // ä¸åº”ä½¿ç”¨ä¸‹åˆ’çº¿
public void user() { }               // ä¸æ¸…æ¥šå…·ä½“æ“ä½œ
```

### å˜é‡åè§„èŒƒ

```java
// âœ… æ­£ç¡®ç¤ºä¾‹
private String username;
private Long userId;
private List<User> userList;
private Map<String, Object> dataMap;
private boolean isDeleted;
private boolean hasPermission;

// âŒ é”™è¯¯ç¤ºä¾‹
private String UserName;      // åº”ä½¿ç”¨å°é©¼å³°
private Long user_id;         // ä¸åº”ä½¿ç”¨ä¸‹åˆ’çº¿
private List<User> list;      // å‘½åå¤ªæ³›åŒ–
private boolean deleted;      // booleanåº”ä»¥is/hasç­‰å¼€å¤´
```

### å¸¸é‡åè§„èŒƒ

```java
// âœ… æ­£ç¡®ç¤ºä¾‹
public static final String DEFAULT_CHARSET = "UTF-8";
public static final int MAX_PAGE_SIZE = 100;
public static final long TOKEN_EXPIRE_TIME = 7200L;

// âŒ é”™è¯¯ç¤ºä¾‹
public static final String defaultCharset = "UTF-8";  // åº”å…¨å¤§å†™
public static final int maxPageSize = 100;           // åº”ä½¿ç”¨ä¸‹åˆ’çº¿åˆ†éš”
```

### æšä¸¾ç±»å‘½å

```java
// âœ… æ­£ç¡®ç¤ºä¾‹
public enum UserStatus {
    NORMAL(1, "æ­£å¸¸"),
    DISABLED(0, "ç¦ç”¨"),
    LOCKED(2, "é”å®š");
    
    private final Integer code;
    private final String desc;
    
    // getter...
}

public enum LoginType {
    PASSWORD,      // å¯†ç ç™»å½•
    SMS,          // çŸ­ä¿¡ç™»å½•
    WECHAT        // å¾®ä¿¡ç™»å½•
}
```

## ğŸ¨ ä»£ç æ ¼å¼

### ç¼©è¿›

- ä½¿ç”¨ **4ä¸ªç©ºæ ¼** ç¼©è¿›ï¼Œä¸ä½¿ç”¨Tab
- IDEé…ç½®ï¼šTabè½¬æ¢ä¸º4ä¸ªç©ºæ ¼

```java
// âœ… æ­£ç¡®
public class UserService {
    public void saveUser() {
        if (user != null) {
            userMapper.insert(user);
        }
    }
}

// âŒ é”™è¯¯ï¼ˆç¼©è¿›ä¸ä¸€è‡´ï¼‰
public class UserService {
  public void saveUser() {
      if (user != null) {
    userMapper.insert(user);
      }
  }
}
```

### å•è¡Œé•¿åº¦

- å•è¡Œå­—ç¬¦æ•°ä¸è¶…è¿‡ **120ä¸ªå­—ç¬¦**
- è¶…è¿‡éœ€è¦æ¢è¡Œï¼Œéµå¾ªä»¥ä¸‹åŸåˆ™ï¼š

```java
// âœ… æ­£ç¡®ï¼šåœ¨é€—å·åæ¢è¡Œ
String message = String.format("ç”¨æˆ·[%s]æ‰§è¡Œäº†æ“ä½œ[%s]ï¼Œ"
        + "ç»“æœä¸º[%s]ï¼Œè€—æ—¶[%d]ms",
        username, operation, result, time);

// âœ… æ­£ç¡®ï¼šæ–¹æ³•å‚æ•°è¿‡å¤šæ—¶æ¢è¡Œ
public void updateUser(Long userId, 
                      String username, 
                      String email,
                      String phone) {
    // ...
}

// âœ… æ­£ç¡®ï¼šé“¾å¼è°ƒç”¨æ¢è¡Œ
List<String> names = userList.stream()
        .filter(user -> user.getStatus() == 1)
        .map(User::getUsername)
        .collect(Collectors.toList());
```

### ç©ºæ ¼è§„èŒƒ

```java
// âœ… æ­£ç¡®ï¼šå…³é”®å­—ä¸æ‹¬å·ä¹‹é—´è¦æœ‰ç©ºæ ¼
if (condition) { }
for (int i = 0; i < 10; i++) { }
while (condition) { }

// âœ… æ­£ç¡®ï¼šè¿ç®—ç¬¦å·¦å³è¦æœ‰ç©ºæ ¼
int result = a + b;
boolean flag = (a > b) && (c < d);

// âœ… æ­£ç¡®ï¼šé€—å·ã€åˆ†å·åè¦æœ‰ç©ºæ ¼
method(arg1, arg2, arg3);

// âŒ é”™è¯¯ï¼šç¼ºå°‘ç©ºæ ¼
if(condition){ }
int result=a+b;
method(arg1,arg2,arg3);
```

### ç©ºè¡Œè§„èŒƒ

```java
public class UserService {
    
    private UserMapper userMapper;
    
    /**
     * ä¿å­˜ç”¨æˆ·
     */
    public void saveUser(User user) {
        validateUser(user);
        
        userMapper.insert(user);
        
        sendNotification(user);
    }
    
    /**
     * éªŒè¯ç”¨æˆ·
     */
    private void validateUser(User user) {
        // ...
    }
}
```

**è§„åˆ™**ï¼š
- æ–¹æ³•ä¹‹é—´ç©ºä¸€è¡Œ
- é€»è¾‘å—ä¹‹é—´ç©ºä¸€è¡Œ
- æˆå‘˜å˜é‡å’Œæ–¹æ³•ä¹‹é—´ç©ºä¸€è¡Œ

### å¤§æ‹¬å·è§„èŒƒ

```java
// âœ… æ­£ç¡®ï¼šK&Ré£æ ¼ï¼ˆæ¨èï¼‰
if (condition) {
    doSomething();
} else {
    doOtherThing();
}

public void method() {
    // ...
}

// âŒ é”™è¯¯ï¼šä¸æ¨èçš„é£æ ¼
if (condition) 
{
    doSomething();
}

// âŒ é”™è¯¯ï¼šå•è¡Œä¹Ÿè¦åŠ å¤§æ‹¬å·
if (condition) doSomething();  // ä¸æ¨è
```

## ğŸ’¬ æ³¨é‡Šè§„èŒƒ

### ç±»æ³¨é‡Š

```java
/**
 * ç”¨æˆ·æœåŠ¡ç±»
 * 
 * <p>æä¾›ç”¨æˆ·çš„å¢åˆ æ”¹æŸ¥ç­‰åŸºç¡€åŠŸèƒ½
 * <p>åŒ…å«ç”¨æˆ·å¯†ç åŠ å¯†ã€æƒé™éªŒè¯ç­‰é€»è¾‘
 * 
 * @author zhangziming
 * @since 1.0.0
 */
public class UserService {
    // ...
}
```

### æ–¹æ³•æ³¨é‡Š

```java
/**
 * ä¿å­˜ç”¨æˆ·ä¿¡æ¯
 * 
 * <p>ä¿å­˜å‰ä¼šè¿›è¡Œä»¥ä¸‹éªŒè¯ï¼š
 * <ul>
 *   <li>ç”¨æˆ·åä¸èƒ½ä¸ºç©º</li>
 *   <li>ç”¨æˆ·åä¸èƒ½é‡å¤</li>
 *   <li>å¯†ç ä¼šè‡ªåŠ¨åŠ å¯†</li>
 * </ul>
 * 
 * @param user ç”¨æˆ·å¯¹è±¡ï¼Œä¸èƒ½ä¸ºnull
 * @return ä¿å­˜åçš„ç”¨æˆ·ID
 * @throws BusinessException å½“ç”¨æˆ·åé‡å¤æ—¶æŠ›å‡º
 */
public Long saveUser(User user) {
    // ...
}
```

### å­—æ®µæ³¨é‡Š

```java
public class User {
    
    /**
     * ç”¨æˆ·ID
     */
    private Long id;
    
    /**
     * ç”¨æˆ·åï¼ˆå”¯ä¸€ï¼‰
     */
    private String username;
    
    /**
     * å¯†ç ï¼ˆBCryptåŠ å¯†å­˜å‚¨ï¼‰
     */
    private String password;
    
    /**
     * ç”¨æˆ·çŠ¶æ€
     * 0-ç¦ç”¨ 1-æ­£å¸¸ 2-é”å®š
     */
    private Integer status;
}
```

### ä»£ç æ³¨é‡Š

```java
public void processOrder(Order order) {
    // 1. éªŒè¯è®¢å•
    validateOrder(order);
    
    // 2. è®¡ç®—ä»·æ ¼
    BigDecimal totalPrice = calculatePrice(order);
    
    // 3. æ‰£å‡åº“å­˜
    reduceStock(order);
    
    // 4. åˆ›å»ºè®¢å•
    orderMapper.insert(order);
    
    // TODO: å‘é€è®¢å•é€šçŸ¥
    // FIXME: éœ€è¦å¢åŠ äº‹åŠ¡å¤„ç†
}
```

### ç‰¹æ®Šæ ‡è®°

| æ ‡è®° | å«ä¹‰ | ä½¿ç”¨åœºæ™¯ |
|------|------|---------|
| `TODO` | å¾…åŠäº‹é¡¹ | éœ€è¦å®ç°ä½†æš‚æ—¶æœªå®ç°çš„åŠŸèƒ½ |
| `FIXME` | éœ€è¦ä¿®å¤ | å·²çŸ¥çš„Bugæˆ–é—®é¢˜ |
| `XXX` | éœ€è¦æ³¨æ„ | å­˜åœ¨é£é™©æˆ–éœ€è¦ç‰¹åˆ«æ³¨æ„çš„åœ°æ–¹ |
| `@deprecated` | å·²åºŸå¼ƒ | ä¸æ¨èä½¿ç”¨çš„æ–¹æ³•æˆ–ç±» |

```java
// TODO: [zhangziming] 2024-10-28 éœ€è¦å¢åŠ ç¼“å­˜é€»è¾‘
public User getUser(Long id) {
    return userMapper.selectById(id);
}

// FIXME: [zhangziming] 2024-10-28 å¹¶å‘æƒ…å†µä¸‹å¯èƒ½æœ‰é—®é¢˜
public void updateUserCount() {
    int count = getCount();
    setCount(count + 1);
}

/**
 * @deprecated ä½¿ç”¨ {@link #saveUser(UserDTO)} ä»£æ›¿
 */
@Deprecated
public void save(User user) {
    // ...
}
```

## ğŸ“ ç¼–ç¨‹è§„çº¦

### å¸¸é‡å®šä¹‰

```java
// âœ… æ­£ç¡®ï¼šå®šä¹‰åœ¨å¸¸é‡ç±»ä¸­
public class CacheConstant {
    /** ç”¨æˆ·ç¼“å­˜å‰ç¼€ */
    public static final String USER_CACHE_PREFIX = "user:";
    
    /** ç”¨æˆ·ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰ */
    public static final long USER_CACHE_EXPIRE = 1800L;
}

// âŒ é”™è¯¯ï¼šé­”æ³•å€¼
userCache.set("user:" + userId, user, 1800);

// âœ… æ­£ç¡®ï¼šä½¿ç”¨å¸¸é‡
userCache.set(USER_CACHE_PREFIX + userId, user, USER_CACHE_EXPIRE);
```

### é›†åˆå¤„ç†

```java
// âœ… æ­£ç¡®ï¼šä½¿ç”¨isEmptyåˆ¤æ–­
if (CollectionUtils.isEmpty(list)) {
    // ...
}

// âŒ é”™è¯¯ï¼šä½¿ç”¨size() == 0åˆ¤æ–­ï¼ˆæ€§èƒ½å·®ï¼‰
if (list.size() == 0) {
    // ...
}

// âœ… æ­£ç¡®ï¼šä½¿ç”¨ArrayListåˆå§‹åŒ–æ—¶æŒ‡å®šå¤§å°
List<User> userList = new ArrayList<>(100);

// âœ… æ­£ç¡®ï¼šä½¿ç”¨Arrays.asListåˆå§‹åŒ–
List<String> list = Arrays.asList("a", "b", "c");

// âŒ é”™è¯¯ï¼šArrays.asListçš„åˆ—è¡¨ä¸èƒ½å¢åˆ 
list.add("d");  // è¿è¡Œæ—¶å¼‚å¸¸

// âœ… æ­£ç¡®ï¼šéœ€è¦å¢åˆ æ—¶ç”¨new ArrayListåŒ…è£…
List<String> list = new ArrayList<>(Arrays.asList("a", "b", "c"));
list.add("d");  // OK
```

### å­—ç¬¦ä¸²å¤„ç†

```java
// âœ… æ­£ç¡®ï¼šä½¿ç”¨equalsåˆ¤æ–­ç›¸ç­‰
if ("admin".equals(username)) {
    // ...
}

// âŒ é”™è¯¯ï¼šå¯èƒ½ç©ºæŒ‡é’ˆ
if (username.equals("admin")) {
    // ...
}

// âœ… æ­£ç¡®ï¼šå­—ç¬¦ä¸²æ‹¼æ¥ä½¿ç”¨StringBuilder
StringBuilder sb = new StringBuilder();
for (String item : list) {
    sb.append(item).append(",");
}

// âŒ é”™è¯¯ï¼šå¾ªç¯ä¸­ä½¿ç”¨+æ‹¼æ¥ï¼ˆæ€§èƒ½å·®ï¼‰
String result = "";
for (String item : list) {
    result += item + ",";
}

// âœ… æ­£ç¡®ï¼šä½¿ç”¨StringUtilså·¥å…·ç±»
if (StringUtils.isNotBlank(username)) {
    // ...
}
```

### æ¡ä»¶åˆ¤æ–­

```java
// âœ… æ­£ç¡®ï¼šé¿å…å¤æ‚çš„æ¡ä»¶åˆ¤æ–­
boolean isValidUser = user != null 
    && StringUtils.isNotBlank(user.getUsername())
    && user.getStatus() == 1;
    
if (isValidUser) {
    // ...
}

// âœ… æ­£ç¡®ï¼šæå‰è¿”å›ï¼Œå‡å°‘åµŒå¥—
public void process(User user) {
    if (user == null) {
        return;
    }
    
    if (StringUtils.isBlank(user.getUsername())) {
        return;
    }
    
    // æ­£å¸¸å¤„ç†é€»è¾‘
    doProcess(user);
}

// âŒ é”™è¯¯ï¼šå¤šå±‚åµŒå¥—
public void process(User user) {
    if (user != null) {
        if (StringUtils.isNotBlank(user.getUsername())) {
            if (user.getStatus() == 1) {
                // æ­£å¸¸å¤„ç†é€»è¾‘
            }
        }
    }
}
```

### ç©ºå€¼å¤„ç†

```java
// âœ… æ­£ç¡®ï¼šè¿”å›ç©ºé›†åˆè€Œä¸æ˜¯null
public List<User> listUsers() {
    List<User> users = userMapper.selectList();
    return users != null ? users : Collections.emptyList();
}

// âŒ é”™è¯¯ï¼šè¿”å›null
public List<User> listUsers() {
    return userMapper.selectList();  // å¯èƒ½ä¸ºnull
}

// âœ… æ­£ç¡®ï¼šä½¿ç”¨Optional
public Optional<User> getUser(Long id) {
    return Optional.ofNullable(userMapper.selectById(id));
}

// ä½¿ç”¨
userService.getUser(1L).ifPresent(user -> {
    // å¤„ç†ç”¨æˆ·
});
```

### å¯¹è±¡æ¯”è¾ƒ

```java
// âœ… æ­£ç¡®ï¼šåŒ…è£…ç±»ä½¿ç”¨equals
Long userId1 = 1L;
Long userId2 = 1L;
if (userId1.equals(userId2)) {
    // ...
}

// âŒ é”™è¯¯ï¼šåŒ…è£…ç±»ä½¿ç”¨ ==
if (userId1 == userId2) {  // å¯èƒ½ä¸ç›¸ç­‰
    // ...
}

// âœ… æ­£ç¡®ï¼šæšä¸¾ä½¿ç”¨ == æˆ– equalséƒ½å¯ä»¥
if (UserStatus.NORMAL == user.getStatus()) {
    // ...
}
```

## âš ï¸ å¼‚å¸¸å¤„ç†

### å¼‚å¸¸åˆ†ç±»

```java
/**
 * ä¸šåŠ¡å¼‚å¸¸
 * å¯é¢„æœŸçš„å¼‚å¸¸ï¼Œéœ€è¦ç»™ç”¨æˆ·å‹å¥½æç¤º
 */
public class BusinessException extends RuntimeException {
    private Integer code;
    
    public BusinessException(String message) {
        super(message);
        this.code = 400;
    }
    
    public BusinessException(Integer code, String message) {
        super(message);
        this.code = code;
    }
}

/**
 * ç³»ç»Ÿå¼‚å¸¸
 * ä¸å¯é¢„æœŸçš„å¼‚å¸¸ï¼Œè®°å½•æ—¥å¿—å¹¶ç»™ç”¨æˆ·é€šç”¨æç¤º
 */
public class SystemException extends RuntimeException {
    public SystemException(String message) {
        super(message);
    }
    
    public SystemException(String message, Throwable cause) {
        super(message, cause);
    }
}
```

### å¼‚å¸¸ä½¿ç”¨è§„èŒƒ

```java
// âœ… æ­£ç¡®ï¼šæŠ›å‡ºå…·ä½“çš„å¼‚å¸¸
public User getUser(Long userId) {
    if (userId == null) {
        throw new BusinessException("ç”¨æˆ·IDä¸èƒ½ä¸ºç©º");
    }
    
    User user = userMapper.selectById(userId);
    if (user == null) {
        throw new BusinessException("ç”¨æˆ·ä¸å­˜åœ¨");
    }
    
    return user;
}

// âŒ é”™è¯¯ï¼šåæ‰å¼‚å¸¸
try {
    doSomething();
} catch (Exception e) {
    // ä»€ä¹ˆéƒ½ä¸åš
}

// âœ… æ­£ç¡®ï¼šè®°å½•æ—¥å¿—æˆ–é‡æ–°æŠ›å‡º
try {
    doSomething();
} catch (Exception e) {
    log.error("æ“ä½œå¤±è´¥", e);
    throw new SystemException("ç³»ç»Ÿå¼‚å¸¸ï¼Œè¯·ç¨åé‡è¯•", e);
}

// âŒ é”™è¯¯ï¼šæ•è·Exception
try {
    doSomething();
} catch (Exception e) {
    // ...
}

// âœ… æ­£ç¡®ï¼šæ•è·å…·ä½“å¼‚å¸¸
try {
    doSomething();
} catch (IOException e) {
    // å¤„ç†IOå¼‚å¸¸
} catch (SQLException e) {
    // å¤„ç†SQLå¼‚å¸¸
}
```

### å…¨å±€å¼‚å¸¸å¤„ç†

```java
@RestControllerAdvice
@Slf4j
public class GlobalExceptionHandler {
    
    /**
     * ä¸šåŠ¡å¼‚å¸¸
     */
    @ExceptionHandler(BusinessException.class)
    public Result<?> handleBusinessException(BusinessException e) {
        log.warn("ä¸šåŠ¡å¼‚å¸¸: {}", e.getMessage());
        return Result.error(e.getCode(), e.getMessage());
    }
    
    /**
     * å‚æ•°æ ¡éªŒå¼‚å¸¸
     */
    @ExceptionHandler(MethodArgumentNotValidException.class)
    public Result<?> handleValidationException(MethodArgumentNotValidException e) {
        String message = e.getBindingResult()
                .getFieldErrors()
                .stream()
                .map(error -> error.getField() + ": " + error.getDefaultMessage())
                .collect(Collectors.joining(", "));
        return Result.error(400, message);
    }
    
    /**
     * ç³»ç»Ÿå¼‚å¸¸
     */
    @ExceptionHandler(Exception.class)
    public Result<?> handleException(Exception e) {
        log.error("ç³»ç»Ÿå¼‚å¸¸", e);
        return Result.error(500, "ç³»ç»Ÿå¼‚å¸¸ï¼Œè¯·ç¨åé‡è¯•");
    }
}
```

## ğŸ“‹ æ—¥å¿—è§„èŒƒ

### æ—¥å¿—çº§åˆ«

| çº§åˆ« | ä½¿ç”¨åœºæ™¯ | ç¤ºä¾‹ |
|------|---------|------|
| ERROR | é”™è¯¯ä¿¡æ¯ | ç³»ç»Ÿå¼‚å¸¸ã€ä¸šåŠ¡å¼‚å¸¸ |
| WARN | è­¦å‘Šä¿¡æ¯ | å‚æ•°ä¸åˆæ³•ã€é™çº§å¤„ç† |
| INFO | é‡è¦ä¿¡æ¯ | å¯åŠ¨ä¿¡æ¯ã€å…³é”®ä¸šåŠ¡æ“ä½œ |
| DEBUG | è°ƒè¯•ä¿¡æ¯ | å¼€å‘è°ƒè¯• |
| TRACE | è·Ÿè¸ªä¿¡æ¯ | è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯ |

### æ—¥å¿—ä½¿ç”¨è§„èŒƒ

```java
@Slf4j
public class UserService {
    
    public void saveUser(User user) {
        // âœ… æ­£ç¡®ï¼šä½¿ç”¨å ä½ç¬¦
        log.info("ä¿å­˜ç”¨æˆ·ï¼Œusername={}, email={}", 
                user.getUsername(), user.getEmail());
        
        // âŒ é”™è¯¯ï¼šä½¿ç”¨å­—ç¬¦ä¸²æ‹¼æ¥ï¼ˆå³ä½¿ä¸è¾“å‡ºä¹Ÿä¼šæ‰§è¡Œæ‹¼æ¥ï¼‰
        log.info("ä¿å­˜ç”¨æˆ·ï¼Œusername=" + user.getUsername());
        
        // âœ… æ­£ç¡®ï¼šå¼‚å¸¸æ—¥å¿—åŒ…å«å †æ ˆ
        try {
            userMapper.insert(user);
        } catch (Exception e) {
            log.error("ä¿å­˜ç”¨æˆ·å¤±è´¥ï¼ŒuserId={}", user.getId(), e);
        }
        
        // âœ… æ­£ç¡®ï¼šæ•æ„Ÿä¿¡æ¯è„±æ•
        log.info("ç”¨æˆ·ç™»å½•ï¼Œusername={}, password={}", 
                user.getUsername(), "******");
    }
}
```

### æ—¥å¿—æ ¼å¼

```yaml
# logback-spring.xml
<pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n</pattern>
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
2024-10-28 10:00:00.123 [http-nio-8080-exec-1] INFO  c.z.b.s.UserService - ä¿å­˜ç”¨æˆ·ï¼Œusername=admin, email=admin@example.com
```

## ğŸ—„ï¸ æ•°æ®åº“è§„èŒƒ

### è¡¨å‘½åè§„èŒƒ

- è¡¨åå…¨éƒ¨å°å†™ï¼Œå•è¯é—´ç”¨ä¸‹åˆ’çº¿åˆ†éš”
- è¡¨åä½¿ç”¨å¤æ•°å½¢å¼æˆ–ä¸šåŠ¡å«ä¹‰æ˜ç¡®çš„åè¯
- ä¸è¦ä½¿ç”¨MySQLä¿ç•™å­—

```sql
-- âœ… æ­£ç¡®
CREATE TABLE sys_user (...);
CREATE TABLE sys_role (...);
CREATE TABLE sys_user_role (...);

-- âŒ é”™è¯¯
CREATE TABLE User (...);        -- ä¸è¦ä½¿ç”¨å¤§å†™
CREATE TABLE user (...);        -- MySQLä¿ç•™å­—
CREATE TABLE sys-user (...);   -- ä¸è¦ä½¿ç”¨è¿å­—ç¬¦
```

### å­—æ®µå‘½åè§„èŒƒ

```sql
CREATE TABLE sys_user (
  -- âœ… æ­£ç¡®ï¼šä¸»é”®ä½¿ç”¨id
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  
  -- âœ… æ­£ç¡®ï¼šå­—æ®µåå…¨å°å†™ï¼Œä¸‹åˆ’çº¿åˆ†éš”
  username VARCHAR(64) NOT NULL,
  password VARCHAR(128) NOT NULL,
  create_time DATETIME NOT NULL,
  update_time DATETIME NOT NULL,
  
  -- âœ… æ­£ç¡®ï¼šå¸ƒå°”å­—æ®µä½¿ç”¨is_å‰ç¼€
  is_deleted TINYINT DEFAULT 0,
  is_enabled TINYINT DEFAULT 1
);

-- âŒ é”™è¯¯ç¤ºä¾‹
CREATE TABLE sys_user (
  userId BIGINT,           -- ä¸è¦ä½¿ç”¨é©¼å³°
  user_name VARCHAR(64),   -- usernameæ›´ç®€æ´
  createTime DATETIME      -- ä¸è¦ä½¿ç”¨é©¼å³°
);
```

### ç´¢å¼•è§„èŒƒ

```sql
-- âœ… æ­£ç¡®ï¼šç´¢å¼•å‘½åè§„èŒƒ
-- å”¯ä¸€ç´¢å¼•ï¼šuk_å­—æ®µå
CREATE UNIQUE INDEX uk_username ON sys_user(username);

-- æ™®é€šç´¢å¼•ï¼šidx_å­—æ®µå
CREATE INDEX idx_create_time ON sys_user(create_time);

-- è”åˆç´¢å¼•ï¼šidx_å­—æ®µ1_å­—æ®µ2
CREATE INDEX idx_username_status ON sys_user(username, status);

-- âŒ é”™è¯¯ï¼šç´¢å¼•åä¸è§„èŒƒ
CREATE INDEX index_1 ON sys_user(username);
CREATE INDEX user_index ON sys_user(username);
```

### SQLç¼–å†™è§„èŒƒ

```java
// âœ… æ­£ç¡®ï¼šä½¿ç”¨é¢„ç¼–è¯‘SQL
@Select("SELECT * FROM sys_user WHERE username = #{username}")
User selectByUsername(@Param("username") String username);

// âŒ é”™è¯¯ï¼šSQLæ‹¼æ¥ï¼ˆæœ‰æ³¨å…¥é£é™©ï¼‰
String sql = "SELECT * FROM sys_user WHERE username = '" + username + "'";

// âœ… æ­£ç¡®ï¼šåˆ†é¡µæŸ¥è¯¢
@Select("SELECT * FROM sys_user LIMIT #{offset}, #{limit}")
List<User> selectByPage(@Param("offset") int offset, 
                       @Param("limit") int limit);

// âœ… æ­£ç¡®ï¼šæ‰¹é‡æ’å…¥
@Insert("<script>" +
        "INSERT INTO sys_user (username, password) VALUES " +
        "<foreach collection='list' item='item' separator=','>" +
        "(#{item.username}, #{item.password})" +
        "</foreach>" +
        "</script>")
int batchInsert(@Param("list") List<User> users);
```

## ğŸ”’ å®‰å…¨è§„èŒƒ

### è¾“å…¥éªŒè¯

```java
// âœ… æ­£ç¡®ï¼šä½¿ç”¨Validationæ³¨è§£
public class UserDTO {
    
    @NotBlank(message = "ç”¨æˆ·åä¸èƒ½ä¸ºç©º")
    @Length(min = 3, max = 20, message = "ç”¨æˆ·åé•¿åº¦ä¸º3-20ä¸ªå­—ç¬¦")
    @Pattern(regexp = "^[a-zA-Z0-9_]+$", message = "ç”¨æˆ·ååªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿")
    private String username;
    
    @NotBlank(message = "å¯†ç ä¸èƒ½ä¸ºç©º")
    @Length(min = 6, max = 20, message = "å¯†ç é•¿åº¦ä¸º6-20ä¸ªå­—ç¬¦")
    private String password;
    
    @Email(message = "é‚®ç®±æ ¼å¼ä¸æ­£ç¡®")
    private String email;
}

@PostMapping("/register")
public Result<Void> register(@Valid @RequestBody UserDTO userDTO) {
    // @Validä¼šè‡ªåŠ¨éªŒè¯
    userService.register(userDTO);
    return Result.success();
}
```

### å¯†ç å¤„ç†

```java
// âœ… æ­£ç¡®ï¼šä½¿ç”¨BCryptåŠ å¯†
@Service
public class UserService {
    
    @Autowired
    private PasswordEncoder passwordEncoder;
    
    public void saveUser(User user) {
        // åŠ å¯†å¯†ç 
        String encryptedPassword = passwordEncoder.encode(user.getPassword());
        user.setPassword(encryptedPassword);
        
        userMapper.insert(user);
    }
    
    public boolean validatePassword(String rawPassword, String encodedPassword) {
        return passwordEncoder.matches(rawPassword, encodedPassword);
    }
}

// âŒ é”™è¯¯ï¼šæ˜æ–‡å­˜å‚¨å¯†ç 
user.setPassword(rawPassword);
userMapper.insert(user);

// âŒ é”™è¯¯ï¼šä½¿ç”¨MD5åŠ å¯†ï¼ˆä¸å®‰å…¨ï¼‰
String md5Password = DigestUtils.md5Hex(password);
```

### SQLæ³¨å…¥é˜²æŠ¤

```java
// âœ… æ­£ç¡®ï¼šä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢
@Select("SELECT * FROM sys_user WHERE username = #{username}")
User selectByUsername(String username);

// âœ… æ­£ç¡®ï¼šMyBatis Plus
QueryWrapper<User> wrapper = new QueryWrapper<>();
wrapper.eq("username", username);
userMapper.selectOne(wrapper);

// âŒ é”™è¯¯ï¼šå­—ç¬¦ä¸²æ‹¼æ¥ï¼ˆæœ‰æ³¨å…¥é£é™©ï¼‰
@Select("SELECT * FROM sys_user WHERE username = '${username}'")
User selectByUsername(String username);
```

### XSSé˜²æŠ¤

```java
// âœ… æ­£ç¡®ï¼šå¯¹è¾“å‡ºè¿›è¡ŒHTMLè½¬ä¹‰
@GetMapping("/user/{id}")
public String getUserInfo(@PathVariable Long id, Model model) {
    User user = userService.getUser(id);
    
    // Thymeleafä¼šè‡ªåŠ¨è½¬ä¹‰
    model.addAttribute("username", user.getUsername());
    
    return "user-info";
}

// åœ¨å‰ç«¯ä½¿ç”¨th:textï¼ˆè‡ªåŠ¨è½¬ä¹‰ï¼‰
// <span th:text="${username}"></span>

// âŒ é”™è¯¯ï¼šä¸è½¬ä¹‰è¾“å‡ºï¼ˆæœ‰XSSé£é™©ï¼‰
// <span th:utext="${username}"></span>
```

## ğŸ§ª å•å…ƒæµ‹è¯•

### æµ‹è¯•ç±»å‘½å

```java
// âœ… æ­£ç¡®ï¼šæµ‹è¯•ç±»ä»¥Testç»“å°¾
public class UserServiceTest {
    // ...
}

// âœ… æ­£ç¡®ï¼šæµ‹è¯•æ–¹æ³•å‘½åæ¸…æ™°
@Test
public void testSaveUser_Success() {
    // ...
}

@Test
public void testSaveUser_WhenUsernameExists_ShouldThrowException() {
    // ...
}
```

### æµ‹è¯•è§„èŒƒ

```java
@SpringBootTest
public class UserServiceTest {
    
    @Autowired
    private UserService userService;
    
    @MockBean
    private UserMapper userMapper;
    
    /**
     * æµ‹è¯•ä¿å­˜ç”¨æˆ· - æˆåŠŸåœºæ™¯
     */
    @Test
    public void testSaveUser_Success() {
        // Given (å‡†å¤‡æµ‹è¯•æ•°æ®)
        User user = new User();
        user.setUsername("test");
        user.setPassword("123456");
        
        when(userMapper.insert(any())).thenReturn(1);
        
        // When (æ‰§è¡Œæµ‹è¯•)
        Long userId = userService.saveUser(user);
        
        // Then (éªŒè¯ç»“æœ)
        assertNotNull(userId);
        verify(userMapper, times(1)).insert(any());
    }
    
    /**
     * æµ‹è¯•ä¿å­˜ç”¨æˆ· - ç”¨æˆ·åå·²å­˜åœ¨
     */
    @Test
    public void testSaveUser_WhenUsernameExists_ShouldThrowException() {
        // Given
        User user = new User();
        user.setUsername("admin");
        
        when(userMapper.selectByUsername("admin"))
            .thenReturn(new User());
        
        // When & Then
        assertThrows(BusinessException.class, () -> {
            userService.saveUser(user);
        });
    }
}
```

### æµ‹è¯•è¦†ç›–ç‡

- å•å…ƒæµ‹è¯•è¦†ç›–ç‡ç›®æ ‡ï¼š**80%ä»¥ä¸Š**
- æ ¸å¿ƒä¸šåŠ¡é€»è¾‘è¦†ç›–ç‡ï¼š**100%**

```bash
# ä½¿ç”¨JaCoCoç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
mvn clean test jacoco:report
```

## ğŸ› ï¸ å·¥å…·é…ç½®

### IDEAé…ç½®

#### 1. ä»£ç æ ¼å¼åŒ–

`Settings â†’ Editor â†’ Code Style â†’ Java`

- Tab size: 4
- Indent: 4
- Continuation indent: 8
- å‹¾é€‰ "Use tab character" å–æ¶ˆ

#### 2. è‡ªåŠ¨å¯¼å…¥ä¼˜åŒ–

`Settings â†’ Editor â†’ General â†’ Auto Import`

- å‹¾é€‰ "Add unambiguous imports on the fly"
- å‹¾é€‰ "Optimize imports on the fly"

#### 3. ä¿å­˜æ—¶æ ¼å¼åŒ–

`Settings â†’ Tools â†’ Actions on Save`

- å‹¾é€‰ "Reformat code"
- å‹¾é€‰ "Optimize imports"

### Mavenæ’ä»¶

```xml
<build>
    <plugins>
        <!-- Checkstyleä»£ç è§„èŒƒæ£€æŸ¥ -->
        <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-checkstyle-plugin</artifactId>
            <version>3.3.0</version>
            <configuration>
                <configLocation>checkstyle.xml</configLocation>
            </configuration>
        </plugin>
        
        <!-- PMDä»£ç è´¨é‡æ£€æŸ¥ -->
        <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-pmd-plugin</artifactId>
            <version>3.21.0</version>
        </plugin>
        
        <!-- JaCoCoæµ‹è¯•è¦†ç›–ç‡ -->
        <plugin>
            <groupId>org.jacoco</groupId>
            <artifactId>jacoco-maven-plugin</artifactId>
            <version>0.8.10</version>
            <executions>
                <execution>
                    <goals>
                        <goal>prepare-agent</goal>
                    </goals>
                </execution>
                <execution>
                    <id>report</id>
                    <phase>test</phase>
                    <goals>
                        <goal>report</goal>
                    </goals>
                </execution>
            </executions>
        </plugin>
    </plugins>
</build>
```

### Git Hooks

åˆ›å»º `.git/hooks/pre-commit`:

```bash
#!/bin/bash

# æ ¼å¼åŒ–æ£€æŸ¥
mvn checkstyle:check

if [ $? -ne 0 ]; then
    echo "ä»£ç æ ¼å¼æ£€æŸ¥å¤±è´¥ï¼Œè¯·ä¿®å¤åå†æäº¤"
    exit 1
fi

# å•å…ƒæµ‹è¯•
mvn test

if [ $? -ne 0 ]; then
    echo "å•å…ƒæµ‹è¯•å¤±è´¥ï¼Œè¯·ä¿®å¤åå†æäº¤"
    exit 1
fi
```

## ğŸ“š å‚è€ƒèµ„æ–™

1. [é˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œ](https://github.com/alibaba/p3c)
2. [Google Java Style Guide](https://google.github.io/styleguide/javaguide.html)
3. [Effective Java](https://www.oreilly.com/library/view/effective-java/9780134686097/)
4. [Clean Code](https://www.oreilly.com/library/view/clean-code-a/9780136083238/)

## âœ… æ£€æŸ¥æ¸…å•

æäº¤ä»£ç å‰è¯·ç¡®è®¤ï¼š

- [ ] ä»£ç ç¬¦åˆå‘½åè§„èŒƒ
- [ ] ä»£ç æ ¼å¼æ­£ç¡®ï¼ˆç¼©è¿›ã€ç©ºæ ¼ã€æ¢è¡Œï¼‰
- [ ] æ·»åŠ äº†å¿…è¦çš„æ³¨é‡Š
- [ ] æ²¡æœ‰ç¡¬ç¼–ç ï¼ˆä½¿ç”¨å¸¸é‡ï¼‰
- [ ] å¼‚å¸¸å¤„ç†æ­£ç¡®
- [ ] æ—¥å¿—ä½¿ç”¨è§„èŒƒ
- [ ] é€šè¿‡å•å…ƒæµ‹è¯•
- [ ] æµ‹è¯•è¦†ç›–ç‡è¾¾æ ‡
- [ ] æ²¡æœ‰ç¼–è¯‘è­¦å‘Š
- [ ] ä»£ç å·²æ ¼å¼åŒ–

---

**éµå®ˆè§„èŒƒï¼Œç¼–å†™ä¼˜é›…çš„ä»£ç ï¼** ğŸ’

*æœ¬æ–‡æ¡£æŒç»­æ›´æ–°ï¼Œæœ€åæ›´æ–°æ—¶é—´: 2024-10-28*

