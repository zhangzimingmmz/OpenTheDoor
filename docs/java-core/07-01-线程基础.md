# çº¿ç¨‹åŸºç¡€ (Thread Fundamentals)

> ç†è§£çº¿ç¨‹çš„æ¦‚å¿µã€åˆ›å»ºæ–¹å¼ã€ç”Ÿå‘½å‘¨æœŸï¼ŒæŒæ¡å¤šçº¿ç¨‹ç¼–ç¨‹çš„åŸºç¡€çŸ¥è¯†

## ç›®å½•
- [1. ä»€ä¹ˆæ˜¯çº¿ç¨‹](#1-ä»€ä¹ˆæ˜¯çº¿ç¨‹)
- [2. çº¿ç¨‹çš„åˆ›å»ºæ–¹å¼](#2-çº¿ç¨‹çš„åˆ›å»ºæ–¹å¼)
- [3. çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ](#3-çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ)
- [4. çº¿ç¨‹çš„åŸºæœ¬æ“ä½œ](#4-çº¿ç¨‹çš„åŸºæœ¬æ“ä½œ)
- [5. å®ˆæŠ¤çº¿ç¨‹](#5-å®ˆæŠ¤çº¿ç¨‹)
- [6. çº¿ç¨‹ä¼˜å…ˆçº§](#6-çº¿ç¨‹ä¼˜å…ˆçº§)
- [7. æœ€ä½³å®è·µ](#7-æœ€ä½³å®è·µ)
- [8. é¢è¯•é«˜é¢‘é—®é¢˜](#8-é¢è¯•é«˜é¢‘é—®é¢˜)

---

## 1. ä»€ä¹ˆæ˜¯çº¿ç¨‹ (What is Thread)

### 1.1 è¿›ç¨‹ä¸çº¿ç¨‹

**è¿›ç¨‹ï¼ˆProcessï¼‰**ï¼šæ“ä½œç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…å’Œè°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ç‹¬ç«‹çš„å†…å­˜ç©ºé—´ã€‚

**çº¿ç¨‹ï¼ˆThreadï¼‰**ï¼šè¿›ç¨‹å†…çš„æ‰§è¡Œå•å…ƒï¼Œæ˜¯CPUè°ƒåº¦çš„åŸºæœ¬å•ä½ã€‚ä¸€ä¸ªè¿›ç¨‹å¯ä»¥åŒ…å«å¤šä¸ªçº¿ç¨‹ï¼Œè¿™äº›çº¿ç¨‹å…±äº«è¿›ç¨‹çš„å†…å­˜ç©ºé—´ã€‚

```
è¿›ç¨‹ (Process)
â”œâ”€â”€ å†…å­˜ç©ºé—´ï¼ˆå †ã€æ–¹æ³•åŒºï¼‰
â”œâ”€â”€ æ–‡ä»¶æè¿°ç¬¦
â”œâ”€â”€ çº¿ç¨‹1 (Thread 1)
â”œâ”€â”€ çº¿ç¨‹2 (Thread 2)
â””â”€â”€ çº¿ç¨‹3 (Thread 3)
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦å¤šçº¿ç¨‹ï¼Ÿ

1. **æé«˜CPUåˆ©ç”¨ç‡** - åœ¨IOç­‰å¾…æ—¶ï¼ŒCPUå¯ä»¥æ‰§è¡Œå…¶ä»–çº¿ç¨‹
2. **æé«˜å“åº”é€Ÿåº¦** - åå°ä»»åŠ¡ä¸é˜»å¡ç”¨æˆ·ç•Œé¢
3. **å……åˆ†åˆ©ç”¨å¤šæ ¸CPU** - å¹¶è¡Œå¤„ç†æé«˜ååé‡
4. **ç®€åŒ–ç¼–ç¨‹æ¨¡å‹** - æŸäº›åœºæ™¯ä¸‹å¤šçº¿ç¨‹æ›´ç›´è§‚

### 1.3 åœ¨ç®—åŠ›å¹³å°ä¸­çš„åº”ç”¨

åœ¨ç®—åŠ›å¹³å°ä¸­ï¼Œå¤šçº¿ç¨‹çš„åº”ç”¨åœºæ™¯ï¼š

- **ä»»åŠ¡è°ƒåº¦çº¿ç¨‹** - å®šæ—¶ä»Nomadè·å–ä»»åŠ¡çŠ¶æ€
- **èŠ‚ç‚¹ç›‘æ§çº¿ç¨‹** - å¹¶å‘é‡‡é›†å¤šä¸ªèŠ‚ç‚¹çš„èµ„æºä¿¡æ¯
- **ç»“ç®—å¤„ç†çº¿ç¨‹** - æ‰¹é‡å¤„ç†ç”¨æˆ·é’±åŒ…çš„æ‰£è´¹å’Œå……å€¼
- **Webè¯·æ±‚å¤„ç†** - Tomcatä½¿ç”¨çº¿ç¨‹æ± å¤„ç†HTTPè¯·æ±‚

---

## 2. çº¿ç¨‹çš„åˆ›å»ºæ–¹å¼ (Thread Creation)

### 2.1 æ–¹å¼ä¸€ï¼šç»§æ‰¿Threadç±»

```java
/**
 * æ–¹å¼ä¸€ï¼šç»§æ‰¿Threadç±»
 * Method 1: Extend Thread Class
 * 
 * ä¼˜ç‚¹ï¼šç®€å•ç›´æ¥
 * ç¼ºç‚¹ï¼šJavaå•ç»§æ‰¿ï¼Œä¸å¤Ÿçµæ´»
 */
public class MyThread extends Thread {
    
    @Override
    public void run() {
        // çº¿ç¨‹æ‰§è¡Œçš„ä»£ç 
        System.out.println("çº¿ç¨‹æ‰§è¡Œä¸­: " + Thread.currentThread().getName());
    }
    
    public static void main(String[] args) {
        MyThread thread = new MyThread();
        thread.start(); // å¯åŠ¨çº¿ç¨‹ï¼Œè°ƒç”¨run()æ–¹æ³•
    }
}
```

**æ³¨æ„äº‹é¡¹ï¼š**
- å¿…é¡»é‡å†™`run()`æ–¹æ³•
- è°ƒç”¨`start()`æ–¹æ³•å¯åŠ¨çº¿ç¨‹ï¼Œè€Œä¸æ˜¯ç›´æ¥è°ƒç”¨`run()`
- `start()`ä¼šåˆ›å»ºæ–°çº¿ç¨‹ï¼Œ`run()`åªæ˜¯æ™®é€šæ–¹æ³•è°ƒç”¨

### 2.2 æ–¹å¼äºŒï¼šå®ç°Runnableæ¥å£ï¼ˆæ¨èï¼‰

```java
/**
 * æ–¹å¼äºŒï¼šå®ç°Runnableæ¥å£ï¼ˆæ¨èï¼‰
 * Method 2: Implement Runnable Interface (Recommended)
 * 
 * ä¼˜ç‚¹ï¼šå¯ä»¥ç»§æ‰¿å…¶ä»–ç±»ï¼Œæ›´çµæ´»
 * ç¼ºç‚¹ï¼šæ— è¿”å›å€¼ï¼Œä¸èƒ½æŠ›å‡ºå—æ£€å¼‚å¸¸
 */
public class MyRunnable implements Runnable {
    
    @Override
    public void run() {
        System.out.println("çº¿ç¨‹æ‰§è¡Œä¸­: " + Thread.currentThread().getName());
    }
    
    public static void main(String[] args) {
        // æ–¹å¼1ï¼šåˆ›å»ºThreadå¯¹è±¡ï¼Œä¼ å…¥Runnable
        Thread thread = new Thread(new MyRunnable());
        thread.start();
        
        // æ–¹å¼2ï¼šä½¿ç”¨Lambdaè¡¨è¾¾å¼ï¼ˆJava 8+ï¼‰
        Thread thread2 = new Thread(() -> {
            System.out.println("Lambdaçº¿ç¨‹æ‰§è¡Œ");
        });
        thread2.start();
    }
}
```

**ä¸ºä»€ä¹ˆæ¨èRunnableï¼Ÿ**
1. å¯ä»¥ç»§æ‰¿å…¶ä»–ç±»ï¼Œæ›´çµæ´»
2. ç¬¦åˆé¢å‘æ¥å£ç¼–ç¨‹çš„åŸåˆ™
3. å¯ä»¥å¤ç”¨åŒä¸€ä¸ªRunnableå¯¹è±¡åˆ›å»ºå¤šä¸ªçº¿ç¨‹

### 2.3 æ–¹å¼ä¸‰ï¼šå®ç°Callableæ¥å£

```java
import java.util.concurrent.Callable;
import java.util.concurrent.FutureTask;

/**
 * æ–¹å¼ä¸‰ï¼šå®ç°Callableæ¥å£
 * Method 3: Implement Callable Interface
 * 
 * ä¼˜ç‚¹ï¼šæœ‰è¿”å›å€¼ï¼Œå¯ä»¥æŠ›å‡ºå¼‚å¸¸
 * ç¼ºç‚¹ï¼šä½¿ç”¨ç›¸å¯¹å¤æ‚
 */
public class MyCallable implements Callable<String> {
    
    @Override
    public String call() throws Exception {
        // æ‰§è¡Œä»»åŠ¡å¹¶è¿”å›ç»“æœ
        Thread.sleep(1000);
        return "ä»»åŠ¡æ‰§è¡Œå®Œæˆ";
    }
    
    public static void main(String[] args) throws Exception {
        // Callableéœ€è¦åŒ…è£…åœ¨FutureTaskä¸­
        FutureTask<String> futureTask = new FutureTask<>(new MyCallable());
        Thread thread = new Thread(futureTask);
        thread.start();
        
        // è·å–è¿”å›å€¼ï¼ˆä¼šé˜»å¡ç›´åˆ°ä»»åŠ¡å®Œæˆï¼‰
        String result = futureTask.get();
        System.out.println("ç»“æœ: " + result);
    }
}
```

**Callable vs Runnableï¼š**

| ç‰¹æ€§ | Runnable | Callable |
|------|----------|----------|
| è¿”å›å€¼ | æ—  | æœ‰ |
| å¼‚å¸¸ | ä¸èƒ½æŠ›å‡ºå—æ£€å¼‚å¸¸ | å¯ä»¥æŠ›å‡ºå¼‚å¸¸ |
| ä½¿ç”¨åœºæ™¯ | ç®€å•ä»»åŠ¡ | éœ€è¦è¿”å›å€¼çš„ä»»åŠ¡ |

### 2.4 æ–¹å¼å››ï¼šä½¿ç”¨çº¿ç¨‹æ± ï¼ˆç”Ÿäº§ç¯å¢ƒæ¨èï¼‰

```java
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;

/**
 * æ–¹å¼å››ï¼šä½¿ç”¨çº¿ç¨‹æ± ï¼ˆç”Ÿäº§ç¯å¢ƒæ¨èï¼‰
 * Method 4: Use Thread Pool (Recommended for Production)
 * 
 * ä¼˜ç‚¹ï¼šèµ„æºå¯æ§ï¼Œæ€§èƒ½å¥½ï¼Œä¾¿äºç®¡ç†
 */
public class ThreadPoolDemo {
    
    public static void main(String[] args) {
        // åˆ›å»ºçº¿ç¨‹æ± 
        ExecutorService executor = Executors.newFixedThreadPool(5);
        
        // æäº¤ä»»åŠ¡
        for (int i = 0; i < 10; i++) {
            final int taskId = i;
            executor.submit(() -> {
                System.out.println("ä»»åŠ¡ " + taskId + " æ‰§è¡Œä¸­");
            });
        }
        
        // å…³é—­çº¿ç¨‹æ± 
        executor.shutdown();
    }
}
```

**çº¿ç¨‹æ± çš„ä¼˜åŠ¿ï¼š**
1. **èµ„æºå¤ç”¨** - é¿å…é¢‘ç¹åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹
2. **èµ„æºå¯æ§** - é™åˆ¶çº¿ç¨‹æ•°é‡ï¼Œé˜²æ­¢èµ„æºè€—å°½
3. **ä»»åŠ¡ç®¡ç†** - æ”¯æŒä»»åŠ¡é˜Ÿåˆ—ã€æ‹’ç»ç­–ç•¥ç­‰

> è¯¦ç»†å†…å®¹è¯·å‚è€ƒï¼š[07-05 - çº¿ç¨‹æ± ](./07-05-çº¿ç¨‹æ± .md)

---

## 3. çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ (Thread Lifecycle)

### 3.1 çº¿ç¨‹çŠ¶æ€ï¼ˆThread Statesï¼‰

Javaçº¿ç¨‹æœ‰6ç§çŠ¶æ€ï¼Œå®šä¹‰åœ¨`Thread.State`æšä¸¾ä¸­ï¼š

```java
public enum State {
    NEW,              // æ–°å»ºçŠ¶æ€
    RUNNABLE,         // å¯è¿è¡ŒçŠ¶æ€
    BLOCKED,          // é˜»å¡çŠ¶æ€
    WAITING,          // ç­‰å¾…çŠ¶æ€
    TIMED_WAITING,    // å®šæ—¶ç­‰å¾…çŠ¶æ€
    TERMINATED        // ç»ˆæ­¢çŠ¶æ€
}
```

### 3.2 çŠ¶æ€è½¬æ¢å›¾

```
        NEW
         |
         | start()
         â†“
    RUNNABLE â†â”€â”€â”€â”€â”€â”€â”€â”€â”
         |            |
         | è·å–CPUæ—¶é—´ç‰‡  |
         |            |
         |            |
    BLOCKED (ç­‰å¾…é”)   |
         |            |
         | è·å–åˆ°é”     |
         |            |
    WAITING (wait())  |
         |            |
         | notify()   |
         |            |
TIMED_WAITING (sleep)â”‚
         |            â”‚
         | æ—¶é—´åˆ°/ä¸­æ–­   â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         |
         | run()æ–¹æ³•æ‰§è¡Œå®Œæ¯•
         â†“
    TERMINATED
```

### 3.3 å„çŠ¶æ€è¯¦è§£

#### NEWï¼ˆæ–°å»ºçŠ¶æ€ï¼‰

çº¿ç¨‹å¯¹è±¡å·²åˆ›å»ºï¼Œä½†å°šæœªè°ƒç”¨`start()`æ–¹æ³•ã€‚

```java
Thread thread = new Thread(() -> {});
System.out.println(thread.getState()); // NEW
```

#### RUNNABLEï¼ˆå¯è¿è¡ŒçŠ¶æ€ï¼‰

çº¿ç¨‹è°ƒç”¨äº†`start()`æ–¹æ³•ï¼Œå¯èƒ½æ­£åœ¨è¿è¡Œï¼Œä¹Ÿå¯èƒ½åœ¨ç­‰å¾…CPUæ—¶é—´ç‰‡ã€‚

```java
Thread thread = new Thread(() -> {
    while (true) {
        // æ‰§è¡Œä»»åŠ¡
    }
});
thread.start();
System.out.println(thread.getState()); // RUNNABLE
```

**æ³¨æ„ï¼š** RUNNABLEçŠ¶æ€åŒ…æ‹¬ï¼š
- **Running** - æ­£åœ¨CPUä¸Šæ‰§è¡Œ
- **Ready** - ç­‰å¾…CPUæ—¶é—´ç‰‡

#### BLOCKEDï¼ˆé˜»å¡çŠ¶æ€ï¼‰

çº¿ç¨‹ç­‰å¾…è·å–ç›‘è§†å™¨é”ï¼ˆmonitor lockï¼‰ï¼Œè¿›å…¥synchronizedä»£ç å—æ—¶ã€‚

```java
Object lock = new Object();

Thread thread1 = new Thread(() -> {
    synchronized (lock) {
        try {
            Thread.sleep(5000); // æŒæœ‰é”5ç§’
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
    }
});

Thread thread2 = new Thread(() -> {
    synchronized (lock) { // ç­‰å¾…thread1é‡Šæ”¾é”
        System.out.println("è·å–åˆ°é”");
    }
});

thread1.start();
Thread.sleep(100); // ç¡®ä¿thread1å…ˆè·å–é”
thread2.start();
Thread.sleep(100);
System.out.println(thread2.getState()); // BLOCKED
```

#### WAITINGï¼ˆç­‰å¾…çŠ¶æ€ï¼‰

çº¿ç¨‹æ— é™æœŸç­‰å¾…å…¶ä»–çº¿ç¨‹çš„ç‰¹å®šæ“ä½œã€‚

```java
Object lock = new Object();

Thread thread = new Thread(() -> {
    synchronized (lock) {
        try {
            lock.wait(); // è¿›å…¥WAITINGçŠ¶æ€
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
    }
});

thread.start();
Thread.sleep(100);
System.out.println(thread.getState()); // WAITING
```

**è¿›å…¥WAITINGçš„æ–¹æ³•ï¼š**
- `Object.wait()` - ç­‰å¾…notify()
- `Thread.join()` - ç­‰å¾…å…¶ä»–çº¿ç¨‹ç»“æŸ
- `LockSupport.park()` - ç­‰å¾…unpark()

#### TIMED_WAITINGï¼ˆå®šæ—¶ç­‰å¾…çŠ¶æ€ï¼‰

çº¿ç¨‹ç­‰å¾…æŒ‡å®šçš„æ—¶é—´ã€‚

```java
Thread thread = new Thread(() -> {
    try {
        Thread.sleep(5000); // ç¡çœ 5ç§’
    } catch (InterruptedException e) {
        e.printStackTrace();
    }
});

thread.start();
Thread.sleep(100);
System.out.println(thread.getState()); // TIMED_WAITING
```

**è¿›å…¥TIMED_WAITINGçš„æ–¹æ³•ï¼š**
- `Thread.sleep(long)` - ç¡çœ æŒ‡å®šæ—¶é—´
- `Object.wait(long)` - ç­‰å¾…æŒ‡å®šæ—¶é—´
- `Thread.join(long)` - ç­‰å¾…å…¶ä»–çº¿ç¨‹æŒ‡å®šæ—¶é—´
- `LockSupport.parkNanos()` / `parkUntil()` - å®šæ—¶ç­‰å¾…

#### TERMINATEDï¼ˆç»ˆæ­¢çŠ¶æ€ï¼‰

çº¿ç¨‹æ‰§è¡Œå®Œæ¯•æˆ–å¼‚å¸¸é€€å‡ºã€‚

```java
Thread thread = new Thread(() -> {
    System.out.println("æ‰§è¡Œå®Œæ¯•");
});

thread.start();
thread.join(); // ç­‰å¾…çº¿ç¨‹ç»“æŸ
System.out.println(thread.getState()); // TERMINATED
```

---

## 4. çº¿ç¨‹çš„åŸºæœ¬æ“ä½œ (Thread Basic Operations)

### 4.1 å¯åŠ¨çº¿ç¨‹ - start()

```java
Thread thread = new Thread(() -> {
    System.out.println("çº¿ç¨‹æ‰§è¡Œ");
});
thread.start(); // å¯åŠ¨çº¿ç¨‹
```

**start() vs run()ï¼š**
- `start()` - åˆ›å»ºæ–°çº¿ç¨‹ï¼Œå¼‚æ­¥æ‰§è¡Œ
- `run()` - æ™®é€šæ–¹æ³•è°ƒç”¨ï¼ŒåŒæ­¥æ‰§è¡Œ

### 4.2 ç­‰å¾…çº¿ç¨‹ç»“æŸ - join()

```java
Thread thread = new Thread(() -> {
    try {
        Thread.sleep(2000);
        System.out.println("ä»»åŠ¡å®Œæˆ");
    } catch (InterruptedException e) {
        e.printStackTrace();
    }
});

thread.start();
thread.join(); // ç­‰å¾…threadæ‰§è¡Œå®Œæ¯•
System.out.println("ä¸»çº¿ç¨‹ç»§ç»­æ‰§è¡Œ");
```

**join()çš„é‡è½½æ–¹æ³•ï¼š**
- `join()` - æ— é™æœŸç­‰å¾…
- `join(long millis)` - ç­‰å¾…æŒ‡å®šæ¯«ç§’æ•°
- `join(long millis, int nanos)` - ç­‰å¾…æŒ‡å®šæ—¶é—´ï¼ˆçº³ç§’ç²¾åº¦ï¼‰

### 4.3 çº¿ç¨‹ç¡çœ  - sleep()

```java
try {
    Thread.sleep(1000); // ç¡çœ 1ç§’
} catch (InterruptedException e) {
    // å¤„ç†ä¸­æ–­å¼‚å¸¸
    e.printStackTrace();
}
```

**æ³¨æ„äº‹é¡¹ï¼š**
- `sleep()`ä¸ä¼šé‡Šæ”¾é”
- å¯èƒ½æŠ›å‡º`InterruptedException`
- ç¡çœ æ—¶é—´ä¸ç²¾ç¡®ï¼Œå¯èƒ½æ›´é•¿

### 4.4 çº¿ç¨‹ä¸­æ–­ - interrupt()

```java
Thread thread = new Thread(() -> {
    while (!Thread.currentThread().isInterrupted()) {
        // æ‰§è¡Œä»»åŠ¡
        try {
            Thread.sleep(1000);
        } catch (InterruptedException e) {
            // æ•è·ä¸­æ–­å¼‚å¸¸ï¼Œé€€å‡ºå¾ªç¯
            System.out.println("çº¿ç¨‹è¢«ä¸­æ–­");
            break;
        }
    }
});

thread.start();
Thread.sleep(5000);
thread.interrupt(); // ä¸­æ–­çº¿ç¨‹
```

**ä¸­æ–­æœºåˆ¶ï¼š**
- `interrupt()` - è®¾ç½®ä¸­æ–­æ ‡å¿—
- `isInterrupted()` - æ£€æŸ¥ä¸­æ–­æ ‡å¿—ï¼ˆä¸æ¸…é™¤ï¼‰
- `interrupted()` - æ£€æŸ¥å¹¶æ¸…é™¤ä¸­æ–­æ ‡å¿—

### 4.5 çº¿ç¨‹è®©æ­¥ - yield()

```java
Thread thread = new Thread(() -> {
    for (int i = 0; i < 100; i++) {
        if (i % 10 == 0) {
            Thread.yield(); // è®©å‡ºCPUæ—¶é—´ç‰‡
        }
        System.out.println(i);
    }
});
```

**æ³¨æ„ï¼š** `yield()`åªæ˜¯å»ºè®®ï¼Œä¸ä¿è¯ä¸€å®šè®©å‡ºCPUã€‚

---

## 5. å®ˆæŠ¤çº¿ç¨‹ (Daemon Thread)

### 5.1 ä»€ä¹ˆæ˜¯å®ˆæŠ¤çº¿ç¨‹ï¼Ÿ

**å®ˆæŠ¤çº¿ç¨‹ï¼ˆDaemon Threadï¼‰**ï¼šä¸ºå…¶ä»–çº¿ç¨‹æä¾›æœåŠ¡çš„çº¿ç¨‹ï¼Œå½“æ‰€æœ‰éå®ˆæŠ¤çº¿ç¨‹ç»“æŸæ—¶ï¼Œå®ˆæŠ¤çº¿ç¨‹ä¼šè‡ªåŠ¨ç»“æŸã€‚

### 5.2 å®ˆæŠ¤çº¿ç¨‹çš„ç‰¹ç‚¹

```java
Thread daemonThread = new Thread(() -> {
    while (true) {
        System.out.println("å®ˆæŠ¤çº¿ç¨‹è¿è¡Œä¸­");
        try {
            Thread.sleep(1000);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
    }
});

daemonThread.setDaemon(true); // è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹
daemonThread.start();

// ä¸»çº¿ç¨‹æ‰§è¡Œå®Œæ¯•åï¼Œå®ˆæŠ¤çº¿ç¨‹è‡ªåŠ¨ç»“æŸ
Thread.sleep(3000);
System.out.println("ä¸»çº¿ç¨‹ç»“æŸ");
```

**å®ˆæŠ¤çº¿ç¨‹çš„ç‰¹ç‚¹ï¼š**
1. å¿…é¡»åœ¨`start()`ä¹‹å‰è®¾ç½®
2. æ‰€æœ‰éå®ˆæŠ¤çº¿ç¨‹ç»“æŸæ—¶ï¼Œå®ˆæŠ¤çº¿ç¨‹è‡ªåŠ¨ç»“æŸ
3. ä¸èƒ½ç”¨äºæ‰§è¡Œé‡è¦ä»»åŠ¡ï¼ˆå¯èƒ½è¢«å¼ºåˆ¶ç»“æŸï¼‰

### 5.3 åº”ç”¨åœºæ™¯

- **GCçº¿ç¨‹** - åƒåœ¾å›æ”¶
- **ç›‘æ§çº¿ç¨‹** - ç³»ç»Ÿç›‘æ§ã€æ—¥å¿—è®°å½•
- **å®šæ—¶ä»»åŠ¡çº¿ç¨‹** - å®šæ—¶æ¸…ç†ç¼“å­˜

---

## 6. çº¿ç¨‹ä¼˜å…ˆçº§ (Thread Priority)

### 6.1 ä¼˜å…ˆçº§è®¾ç½®

```java
Thread thread1 = new Thread(() -> {
    for (int i = 0; i < 100; i++) {
        System.out.println("Thread 1: " + i);
    }
});

Thread thread2 = new Thread(() -> {
    for (int i = 0; i < 100; i++) {
        System.out.println("Thread 2: " + i);
    }
});

thread1.setPriority(Thread.MAX_PRIORITY); // 10
thread2.setPriority(Thread.MIN_PRIORITY); // 1

thread1.start();
thread2.start();
```

**ä¼˜å…ˆçº§èŒƒå›´ï¼š**
- `MIN_PRIORITY = 1`
- `NORM_PRIORITY = 5`ï¼ˆé»˜è®¤ï¼‰
- `MAX_PRIORITY = 10`

### 6.2 æ³¨æ„äº‹é¡¹

âš ï¸ **ä¼˜å…ˆçº§åªæ˜¯å»ºè®®ï¼Œä¸ä¿è¯æ‰§è¡Œé¡ºåº**

ä¸åŒæ“ä½œç³»ç»Ÿçš„çº¿ç¨‹è°ƒåº¦ç­–ç•¥ä¸åŒï¼Œä¼˜å…ˆçº§å¯èƒ½ä¸èµ·ä½œç”¨ã€‚ç”Ÿäº§ç¯å¢ƒä¸­**ä¸å»ºè®®ä¾èµ–ä¼˜å…ˆçº§**ï¼Œåº”è¯¥ä½¿ç”¨æ›´å¯é çš„åŒæ­¥æœºåˆ¶ã€‚

---

## 7. æœ€ä½³å®è·µ (Best Practices)

### 7.1 çº¿ç¨‹å‘½å

```java
Thread thread = new Thread(() -> {
    // ä»»åŠ¡é€»è¾‘
}, "Task-Thread-1"); // ç»™çº¿ç¨‹å‘½å

// æˆ–è€…åœ¨run()æ–¹æ³•ä¸­
Thread.currentThread().setName("Custom-Name");
```

**å¥½å¤„ï¼š** ä¾¿äºè°ƒè¯•å’Œæ—¥å¿—è¿½è¸ª

### 7.2 å¼‚å¸¸å¤„ç†

```java
Thread thread = new Thread(() -> {
    try {
        // å¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„ä»»åŠ¡
        riskyTask();
    } catch (Exception e) {
        // è®°å½•æ—¥å¿—
        logger.error("çº¿ç¨‹æ‰§è¡Œå¼‚å¸¸", e);
        // ä¸è¦åæ‰å¼‚å¸¸
    }
});

// æˆ–è€…ä½¿ç”¨UncaughtExceptionHandler
thread.setUncaughtExceptionHandler((t, e) -> {
    logger.error("çº¿ç¨‹ " + t.getName() + " æœªæ•è·å¼‚å¸¸", e);
});
```

### 7.3 é¿å…ç›´æ¥ç»§æ‰¿Thread

```java
// âŒ ä¸æ¨è
class MyThread extends Thread {
    // ...
}

// âœ… æ¨è
class MyTask implements Runnable {
    // ...
}
Thread thread = new Thread(new MyTask());
```

### 7.4 ä½¿ç”¨çº¿ç¨‹æ± 

```java
// âŒ ä¸æ¨èï¼šç›´æ¥åˆ›å»ºçº¿ç¨‹
for (int i = 0; i < 100; i++) {
    new Thread(() -> {
        // ä»»åŠ¡
    }).start();
}

// âœ… æ¨èï¼šä½¿ç”¨çº¿ç¨‹æ± 
ExecutorService executor = Executors.newFixedThreadPool(10);
for (int i = 0; i < 100; i++) {
    executor.submit(() -> {
        // ä»»åŠ¡
    });
}
```

---

## 8. é¢è¯•é«˜é¢‘é—®é¢˜ (Interview Questions)

### Q1: start()å’Œrun()çš„åŒºåˆ«ï¼Ÿ

**ç­”æ¡ˆï¼š**
- `start()` - åˆ›å»ºæ–°çº¿ç¨‹ï¼Œå¼‚æ­¥æ‰§è¡Œrun()æ–¹æ³•
- `run()` - æ™®é€šæ–¹æ³•è°ƒç”¨ï¼ŒåŒæ­¥æ‰§è¡Œï¼Œä¸ä¼šåˆ›å»ºæ–°çº¿ç¨‹

```java
Thread thread = new Thread(() -> System.out.println("æ‰§è¡Œ"));

thread.start(); // åˆ›å»ºæ–°çº¿ç¨‹æ‰§è¡Œ
thread.run();   // åœ¨å½“å‰çº¿ç¨‹æ‰§è¡Œ
```

### Q2: çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸæœ‰å“ªäº›çŠ¶æ€ï¼Ÿ

**ç­”æ¡ˆï¼š** NEWã€RUNNABLEã€BLOCKEDã€WAITINGã€TIMED_WAITINGã€TERMINATED

### Q3: å¦‚ä½•åˆ›å»ºçº¿ç¨‹ï¼Ÿæ¨èå“ªç§æ–¹å¼ï¼Ÿ

**ç­”æ¡ˆï¼š**
1. ç»§æ‰¿Threadç±»
2. å®ç°Runnableæ¥å£ï¼ˆæ¨èï¼‰
3. å®ç°Callableæ¥å£ï¼ˆéœ€è¦è¿”å›å€¼æ—¶ï¼‰
4. ä½¿ç”¨çº¿ç¨‹æ± ï¼ˆç”Ÿäº§ç¯å¢ƒæ¨èï¼‰

### Q4: å®ˆæŠ¤çº¿ç¨‹å’Œæ™®é€šçº¿ç¨‹çš„åŒºåˆ«ï¼Ÿ

**ç­”æ¡ˆï¼š**
- å®ˆæŠ¤çº¿ç¨‹ï¼šä¸ºå…¶ä»–çº¿ç¨‹æœåŠ¡ï¼Œæ‰€æœ‰éå®ˆæŠ¤çº¿ç¨‹ç»“æŸæ—¶è‡ªåŠ¨ç»“æŸ
- æ™®é€šçº¿ç¨‹ï¼šæ‰§è¡Œä¸»è¦ä¸šåŠ¡é€»è¾‘ï¼Œå¿…é¡»æ‰§è¡Œå®Œæ¯•

### Q5: sleep()å’Œwait()çš„åŒºåˆ«ï¼Ÿ

**ç­”æ¡ˆï¼š**

| ç‰¹æ€§ | sleep() | wait() |
|------|---------|--------|
| æ‰€å±ç±» | Thread | Object |
| é‡Šæ”¾é” | å¦ | æ˜¯ |
| å”¤é†’æ–¹å¼ | æ—¶é—´åˆ° | notify()/notifyAll() |
| ä½¿ç”¨åœºæ™¯ | æš‚åœæ‰§è¡Œ | çº¿ç¨‹é—´é€šä¿¡ |

---

## ğŸ“– æ‰©å±•é˜…è¯»

- [Java Thread API](https://docs.oracle.com/javase/8/docs/api/java/lang/Thread.html)
- [Java Concurrency Tutorial](https://docs.oracle.com/javase/tutorial/essential/concurrency/)

---

**è¿”å›ï¼š** [07-Javaå¹¶å‘ç¼–ç¨‹](./07-Javaå¹¶å‘ç¼–ç¨‹.md)  
**ä¸‹ä¸€ç« ï¼š** [07-02 - çº¿ç¨‹åŒæ­¥ä¸å†…å­˜æ¨¡å‹ â†’](./07-02-çº¿ç¨‹åŒæ­¥ä¸å†…å­˜æ¨¡å‹.md)

